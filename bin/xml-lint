#!/usr/bin/env bash
#
# Lint ruleset XML file.
#
# Depends on wget and libxml2-utils
#
# Usage:
#
#   ./bin/xml-lint

RULESET="./phpcs.xml.dist"
UNIT_TEST_CONFIG="./phpunit.xml.dist"

set -e

# Check dependency
hash xmllint

# Create temporary directory
mkdir -p tmp

# Current directory should be repository root
test -r "$RULESET"

# Download XML schema definitions
wget -nv -N -P tmp/ "https://www.w3.org/2012/04/XMLSchema.xsd"
wget -nv -N -P tmp/ "https://github.com/squizlabs/PHP_CodeSniffer/raw/master/phpcs.xsd"
wget -nv -N -P tmp/ "https://github.com/sebastianbergmann/phpunit/raw/master/phpunit.xsd"

xmllint --noout --schema tmp/XMLSchema.xsd tmp/phpcs.xsd
xmllint --noout --schema tmp/phpcs.xsd "$RULESET"
diff -B "$RULESET" <(XMLLINT_INDENT="	" xmllint --format "$RULESET")

xmllint --noout --schema tmp/XMLSchema.xsd tmp/phpunit.xsd
xmllint --noout --schema tmp/phpunit.xsd "$UNIT_TEST_CONFIG"
diff -B "$UNIT_TEST_CONFIG" <(XMLLINT_INDENT="	" xmllint --format "$UNIT_TEST_CONFIG")

